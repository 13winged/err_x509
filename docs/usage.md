# Usage Guide

This guide covers how to use err_x509 to fix SSL certificate errors in Clash configurations.

## Table of Contents

- [Installation](#installation)
- [Basic Usage](#basic-usage)
- [Command Reference](#command-reference)
- [Examples](#examples)
- [Troubleshooting](#troubleshooting)
- [FAQ](#faq)

## Installation

### From PyPI (Recommended)

```bash
pip install err-x509
```

### From Source

```bash
git clone https://github.com/13winged/err_x509.git
cd err_x509
pip install -e .
```

### Using Install Script

```bash
# Make script executable
chmod +x scripts/install.sh

# Run installer
./scripts/install.sh

# With shell completion
./scripts/install.sh --with-completion
```

## Basic Usage

### Fix a Single Configuration

```bash
# Basic usage (creates config_fixed.yaml)
err_x509 fix config.yaml

# Specify output file
err_x509 fix input.yaml output_fixed.yaml

# Verbose output with backup
err_x509 fix -v -b config.yaml
```

### Batch Processing

```bash
# Process all YAML files in directory
err_x509 batch ./configs/

# With custom pattern
err_x509 batch ./configs/ -p "*.yml"
```

### Preview Changes

```bash
# See what will be changed without saving
err_x509 preview config.yaml
```

## Command Reference

### `err_x509 fix`

Fix SSL certificate errors in a Clash configuration file.

**Usage:**
```bash
err_x509 fix [OPTIONS] [INPUT_FILE] [OUTPUT_FILE]
```

**Options:**
- `-v, --verbose` - Enable verbose output
- `-b, --backup` - Create backup of original file
- `-f, --force` - Overwrite output file if exists
- `--dry-run` - Show what would be done without making changes

**Arguments:**
- `INPUT_FILE` - Input YAML configuration file
- `OUTPUT_FILE` - Output YAML file (optional, defaults to input_fixed.yaml)

### `err_x509 batch`

Fix SSL certificate errors in all Clash configuration files in a directory.

**Usage:**
```bash
err_x509 batch [OPTIONS] DIRECTORY
```

**Options:**
- `-v, --verbose` - Enable verbose output
- `-p, --pattern` - File pattern to match (default: *.yaml)
- `--dry-run` - Show what would be done without making changes

### `err_x509 preview`

Preview changes that would be made to a configuration file.

**Usage:**
```bash
err_x509 preview [OPTIONS] INPUT_FILE
```

### `err_x509 check`

Check system compatibility and dependencies.

**Usage:**
```bash
err_x509 check
```

### Global Options

- `--version` - Show version and exit
- `--help` - Show help message and exit

## Examples

### Example 1: Basic Fix

**Input file (`config.yaml`):**
```yaml
port: 7890
proxies:
  - {name: Server1, server: s1.example.com, port: 443}
  - {name: Server2, server: s2.example.com, port: 443}
```

**Command:**
```bash
err_x509 fix config.yaml
```

**Output file (`config_fixed.yaml`):**
```yaml
# ===========================================================================
# Clash Configuration with SSL Verification Disabled
# Generated by err_x509 v1.0.0
# GitHub: https://github.com/13winged/err_x509
# Source: config.yaml
# Generated: 2024-01-15 10:30:00
# ===========================================================================

port: 7890
proxies:
  - {name: Server1, server: s1.example.com, port: 443, skip-cert-verify: true}
  - {name: Server2, server: s2.example.com, port: 443, skip-cert-verify: true}

# ===========================================================================
# Statistics
# Total proxies processed: 2
# SSL verification disabled for all servers
# Output file: config_fixed.yaml
# 
# Security Warning:
# skip-cert-verify: true disables SSL certificate validation.
# Use only with trusted servers in non-sensitive contexts.
# ===========================================================================
```

### Example 2: Verbose Mode

```bash
err_x509 fix -v config.yaml
```

**Output:**
```
üìù Processing: config.yaml
üîç Normalizing configuration format...
üîó Processing proxy: Server1
üîó Processing proxy: Server2
‚úÖ Fixed: config_fixed.yaml (2 proxies)
‚úÖ Successfully processed: config_fixed.yaml
```

### Example 3: Batch Processing

```bash
err_x509 batch ./my_configs/ -v
```

**Output:**
```
üîç Batch processing: ./my_configs/
üìÅ Found 3 files
üìù Processing: config1.yaml
‚úÖ Fixed: config1_fixed.yaml (5 proxies)
üìù Processing: config2.yaml
‚úÖ Fixed: config2_fixed.yaml (3 proxies)
üìù Processing: config3.yaml
‚úÖ Fixed: config3_fixed.yaml (8 proxies)

üìä BATCH PROCESSING SUMMARY
==================================================
‚úÖ Successful: 3/3
üîó Total proxies: 16
==================================================
```

## Troubleshooting

### Common Issues

#### 1. "File not found" Error
```bash
‚ùå File not found: config.yaml
```

**Solution:** Check the file path and ensure the file exists.

#### 2. "No proxies section found" Warning
```
‚ö†Ô∏è No proxies section found in configuration
```

**Solution:** Ensure your configuration file has a `proxies:` section.

#### 3. Permission Denied
```
‚ùå Permission denied: /etc/clash/config.yaml
```

**Solution:** Run with appropriate permissions or copy the file to a user directory.

#### 4. Invalid YAML Format
```
‚ùå Invalid YAML syntax: mapping values are not allowed here
```

**Solution:** Check your YAML file for syntax errors. You can use online YAML validators.

### Debug Mode

For detailed debugging information, set the `ERR_X509_DEBUG` environment variable:

```bash
# Linux/macOS
export ERR_X509_DEBUG=1
err_x509 fix config.yaml

# Windows (Command Prompt)
set ERR_X509_DEBUG=1
err_x509 fix config.yaml

# Windows (PowerShell)
$env:ERR_X509_DEBUG=1
err_x509 fix config.yaml
```

## FAQ

### Q: What does `skip-cert-verify: true` do?
A: It disables SSL certificate verification for proxy connections. This fixes x509 certificate errors but reduces security.

### Q: Is this tool safe to use?
A: The tool itself is safe, but disabling SSL verification reduces security. Only use with trusted proxy servers in non-sensitive contexts.

### Q: Does this modify my original files?
A: By default, no. It creates new files with `_fixed` suffix. Use `--backup` to create backups of originals.

### Q: Can I process multiple files at once?
A: Yes, use the `batch` command to process all YAML files in a directory.

### Q: What YAML formats are supported?
A: Both single-line (`- {name: ...}`) and multi-line formats are supported.

### Q: How do I undo the changes?
A: If you used `--backup`, original files are saved with `.backup` suffix. Otherwise, keep your original files separately.

## Getting Help

- Check the [GitHub Issues](https://github.com/13winged/err_x509/issues)
- Review the [API Documentation](api.md)
- Read [Advanced Usage](advanced.md)

---

Next: [API Documentation](api.md) ‚Üí [Advanced Usage](advanced.md)